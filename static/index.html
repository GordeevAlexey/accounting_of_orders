<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Система учета поручений</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.1.1/css/tabulator.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.1.1/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet">
<style>
            <style>

                body {
                background-color: white
                 }

            img {
            width: 250px;
            align: center;
                }

            p {
            font-family: sans-serif;
            font-size: 30px;
            text-align: center
            }

            form {
                text-align:center;
                 }

            .btn, input, select {
                width:400px;
                padding:18px;
                border-radius: 10px;
                border:0;
                box-shadow:0 0 15px 2px rgba(60,74,123,.7);
                border-bottom:1px ;
                box-sizing: border-box;
                margin:8px
            }

            textarea{
                font-family: Verdana;
                font-size: 30;
                width:1660px;
                height:400px;
                padding:18px;
                border-radius: 10px;
                border:0;
                box-shadow:0 0 15px 2px rgba(60,74,123,.7);
                border-bottom:1px ;
                box-sizing: border-box;
                margin:8px
            }

            input:hover, input:focus,
            button:hover, button:focus,
            select:hover, select:focus {
            box-shadow:0 0 15px 2px rgba(60,123,68,.7);
            outline:0;
            }

</style>
<style>
            .modalwin {
                height: 800px;
                width: 550px;
                border: 3px outset gray;
                background: Gainsboro;
                top: 10%; /* отступ сверху */
                right: 0;
                left: 0;
                font-size: 14px;
                margin: 0 auto;
                z-index:2; /* поверх всех */
                display: none;  /* сначала невидим */
                position: fixed; /* фиксированное позиционирование, окно стабильно при прокрутке */
                padding: 15px;
                border: 1px solid #383838;
            }
            #shadow {
                position: fixed;
                width:100%;
                height:100%;
                z-index:1; /* поверх всех  кроме окна*/
                background:#000;
                opacity: 0.7; /*прозрачность*/
                left:0;
                top:0;
            }
        </style>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.1.1/js/tabulator.min.js"></script>
<script type="text/javascript" src="http://192.168.200.168:8004/sandbox/static/tabulator.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>

<body>
<div id="orders_manual">
    <h1>Реестр документов</h1>
    <input type="button" value="Добавить документ" onclick="showModalWin('add_order')">
    <input type="button" value="Удалить документ" onclick="showModalWin()">
</div>
<div id="orders"></div>
<div id="suborders_manual" hidden>
    <h1>Реестр поручений</h1>
    <input type="button" value="Добавить поручение" onclick="showModalWin('add_suborder')">
    <input type="button" value="Удалить поручение" onclick="showModalWin()">
</div>
<div id="suborders"></div>

<div style="text-align: center" id="add_order" class="modalwin">
    <form action="/add_task" method="post">
        <select class="js-example-basic-multiple" name="issue_type" id="issue_type">
            <option value="Приказ" selected>Приказ</option>
        </select>
        <input name="issue_idx" type="text" placeholder="Номер №">
        <input name="approving_date" type="text" onfocus="(this.type='date')" onblur="(this.type='text')" placeholder="Дата утверждения">
        <input name="title" type="text" placeholder="Тема">
        <select class="initiator" name="initiator" multiple="multiple" placeholder="Инициатор">
            <option value="Терехина Елена Сергеевна">Терехина Елена Сергеевна</option>
            <option value="Косенкова Ирина Александровна">Косенкова Ирина Александровна</option>
            <option value="Красильникова Татьяна Владимировна">Красильникова Татьяна Владимировна</option>
            <option value="Шачнева Татьяна Алексеевна">Шачнева Татьяна Алексеевна</option>
            <option value="Локоть Марина Борисовна">Локоть Марина Борисовна</option>
        </select><br><br>
        <select class="approving_employee" name="approving_employee" id="approving_employee" multiple="multiple">
            <option value="Терехина Елена Сергеевна">Терехина Елена Сергеевна</option>
            <option value="Косенкова Ирина Александровна">Косенкова Ирина Александровна</option>
            <option value="Красильникова Татьяна Владимировна">Красильникова Татьяна Владимировна</option>
            <option value="Шачнева Татьяна Алексеевна">Шачнева Татьяна Алексеевна</option>
            <option value="Локоть Марина Борисовна">Локоть Марина Борисовна</option>
        </select>
        <input name="deadline" type="text" onfocus="(this.type='date')" onblur="(this.type='text')" placeholder="Срок исполнения">
        <input name="comment" type="text" placeholder="Примечание">
        <input name="reference" type="text" placeholder="Ссылка">
        <input type="submit" name="submit" value="Сохранить">
    </form>
</div>

<div style="text-align: center" id="add_suborder" class="modalwin">
    <form action="/add_task" method="post">
        <input name="title" type="text" placeholder="Тема">
        <select class="employee" name="approving_employee" id="employee" multiple="multiple">
            <option value="Терехина Елена Сергеевна">Терехина Елена Сергеевна</option>
            <option value="Косенкова Ирина Александровна">Косенкова Ирина Александровна</option>
            <option value="Красильникова Татьяна Владимировна">Красильникова Татьяна Владимировна</option>
            <option value="Шачнева Татьяна Алексеевна">Шачнева Татьяна Алексеевна</option>
            <option value="Локоть Марина Борисовна">Локоть Марина Борисовна</option>
        </select>
        <input name="deadline" type="text" onfocus="(this.type='date')" onblur="(this.type='text')" placeholder="Исполнить до...">
        <input name="title" type="text" placeholder="Описание поручения">
        <input type="submit" name="submit" value="Сохранить">
    </form>
</div>

<script>


    $(document).ready(function() {

    $('.initiator').select2({
        placeholder: "Выбирите инициатора"});

    $('.approving_employee').select2({
        placeholder: "Выбирите утверждающего руководителя"});


    var url = 'http://192.168.200.168:8004/get_order';


    $.get(url, function(response) {

        var orders = new Tabulator('#orders', {
        pagination: 'local',
        paginationSize: 10,
        data: JSON.parse(response),
        layout: 'fitColumns',
        columns: [
                    { title: 'Вид поручения', field: 'issue_type' },
                    { title: 'Номер №', field: 'issue_idx' },
                    { title: 'Дата утверждения', field: 'approving_date' },
                    { title: 'Тема', field: 'title' },
                    { title: 'Инициатор', field: 'initiator' },
                    { title: 'Утверждающий руководитель', field: 'approving_employee' },
                    { title: 'Cтатус', field: 'status_code'},
                    { title: 'Срок исполнения', field: 'deadline' },
                    { title: 'Примечание', field: 'comment' },
                    { title: 'Ссылка', field: 'reference ' }
                 ],


        rowClick:function(e, row){
            if (row.getData().status_code == 'На исполнении') {

                var url = `http://192.168.200.168:8004/get_suborder/${row.getData().id}`;
                $.get(url, function(response) {
                var suborders = new Tabulator('#suborders', {
                pagination: 'local',
                paginationSize: 10,
                data: JSON.parse(response),
                layout: 'fitColumns',
                columns: [
                            { title: 'Дата создания', field: 'create_date'},
                            { title: 'Тема', field: 'title'},
                            { title: 'Исполнитель', field: 'employee'},
                            { title: 'Срок исполнения', field: 'deadline'},
                            { title: 'Текст поручения', field: 'content'},
                            { title: 'Статус', field: 'status_code'},
                            { title: 'Комментарии', field: 'comment'}
                         ]})})
                $("#suborders").show(300)
                $("#suborders_manual").show(300)
            } else {
              $("#suborders").hide(300)
              $("#suborders_manual").hide(300)
            }
}
});
    });
});
</script>

<script>
    function showModalWin() {
        var darkLayer = document.createElement('div'); // слой затемнения
        darkLayer.id = 'shadow'; // id чтобы подхватить стиль
        document.body.appendChild(darkLayer); // включаем затемнение

        var modalWin = document.getElementById(arguments[0]); // находим наше "окно"
        modalWin.style.display = 'block'; // "включаем" его

        darkLayer.onclick = function () {  // при клике на слой затемнения все исчезнет
        darkLayer.parentNode.removeChild(darkLayer); // удаляем затемнение
        modalWin.style.display = 'none'; // делаем окно невидимым
            return false;
            };
        }
</script>


</body>


